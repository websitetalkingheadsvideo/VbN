# Valley by Night - Apache Configuration

# Enable Rewrite Engine
RewriteEngine On

# Force HTTPS (optional - uncomment if you want to force SSL)
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Remove www (or add www if preferred)
# RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
# RewriteRule ^(.*)$ http://%1/$1 [R=301,L]

# Prevent Directory Listing
Options -Indexes

# Custom Error Pages
ErrorDocument 404 /404.php
ErrorDocument 500 /500.php

# ============================================
# Modern Image & Video MIME Types
# ============================================

# Modern Image Formats
AddType image/webp .webp
AddType image/avif .avif
AddType image/jxl .jxl
AddType image/apng .apng

# Standard Image Formats
AddType image/jpeg .jpg .jpeg
AddType image/png .png
AddType image/gif .gif
AddType image/svg+xml .svg .svgz
AddType image/bmp .bmp
AddType image/tiff .tif .tiff
AddType image/x-icon .ico .cur

# Modern Video Formats
AddType video/webm .webm
AddType video/mp4 .mp4
AddType video/x-matroska .mkv
AddType video/quicktime .mov
AddType video/x-msvideo .avi
AddType video/x-ms-wmv .wmv
AddType video/ogg .ogv
AddType video/3gpp .3gp .3gpp
AddType video/3gpp2 .3g2
AddType video/mp2t .ts

# Audio Formats
AddType audio/mpeg .mp3
AddType audio/ogg .oga .ogg
AddType audio/wav .wav
AddType audio/webm .weba
AddType audio/aac .aac
AddType audio/flac .flac
AddType audio/opus .opus

# Font Files
AddType font/woff .woff
AddType font/woff2 .woff2
AddType font/ttf .ttf
AddType font/otf .otf
AddType application/font-woff .woff
AddType application/font-woff2 .woff2

# ============================================
# File Compression (GZIP)
# ============================================

<IfModule mod_deflate.c>
    # Compress HTML, CSS, JavaScript, Text, XML and fonts
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/javascript
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE application/ld+json
    AddOutputFilterByType DEFLATE image/svg+xml
    AddOutputFilterByType DEFLATE application/font-woff
    AddOutputFilterByType DEFLATE application/font-woff2
    AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
    AddOutputFilterByType DEFLATE font/woff
    AddOutputFilterByType DEFLATE font/woff2
    AddOutputFilterByType DEFLATE font/ttf
    AddOutputFilterByType DEFLATE font/otf
</IfModule>

# ============================================
# Browser Caching
# ============================================

<IfModule mod_expires.c>
    ExpiresActive On
    
    # Images
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/avif "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/x-icon "access plus 1 year"
    
    # Video
    ExpiresByType video/mp4 "access plus 1 year"
    ExpiresByType video/webm "access plus 1 year"
    
    # Audio
    ExpiresByType audio/mpeg "access plus 1 year"
    ExpiresByType audio/ogg "access plus 1 year"
    
    # Fonts
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType font/ttf "access plus 1 year"
    ExpiresByType font/otf "access plus 1 year"
    
    # CSS and JavaScript
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    
    # HTML
    ExpiresByType text/html "access plus 0 seconds"
</IfModule>

# ============================================
# Security Headers
# ============================================

<IfModule mod_headers.c>
    # Prevent clickjacking
    Header set X-Frame-Options "SAMEORIGIN"
    
    # Prevent MIME type sniffing
    Header set X-Content-Type-Options "nosniff"
    
    # Enable XSS filtering
    Header set X-XSS-Protection "1; mode=block"
    
    # Referrer Policy
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# ============================================
# PHP Configuration (if allowed)
# ============================================

# <IfModule mod_php.c>
#     php_value upload_max_filesize 10M
#     php_value post_max_size 10M
#     php_value max_execution_time 300
#     php_value max_input_time 300
# </IfModule>

# ============================================
# Disable Server Signature
# ============================================

ServerSignature Off

# ============================================
# Protect Sensitive Files
# ============================================

<FilesMatch "\.(env|json|log|md|txt|bak|backup|old|sql|ini|conf|config)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Allow access to specific files
<FilesMatch "(VERSION|README|LICENSE|CHANGELOG)\.md$">
    Order allow,deny
    Allow from all
</FilesMatch>

# ============================================
# Protect .htaccess and .htpasswd
# ============================================

<FilesMatch "^\.ht">
    Order allow,deny
    Deny from all
</FilesMatch>
